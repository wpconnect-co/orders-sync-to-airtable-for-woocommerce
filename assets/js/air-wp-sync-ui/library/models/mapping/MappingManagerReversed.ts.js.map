{"version":3,"file":"MappingManagerReversed.ts.js","sources":["../../../src/models/mapping/MappingManagerReversed.ts"],"sourcesContent":["import { arrayMoveImmutable } from 'array-move';\nimport { v4 as uuidv4 } from 'uuid';\nimport {\n\tAirtableField,\n\tMapping,\n\tMappingGroupOptions,\n\tMappingOption,\n\tAirtableSelectFieldGroupOption,\n\tAirtableSelectFieldGroupOptions,\n\tSetMappingSignature,\n\tSupportedSource,\n\tWordPressSelectFieldGroupOptions,\n\tWordPressField,\n\tWordPressOptionEnablingStrategy,\n\tAirtableOptionEnablingStrategy\n} from \"./Mapping.types\";\n\nconst isWordPressOptionEnabled = (option:MappingOption, wordPressFieldsSelected:string[], airtableFieldsSelected:string[]):boolean => {\n\treturn option.enabled && (wordPressFieldsSelected.indexOf(option.value) === -1 || option.allow_multiple);\n}\nconst isAirtableOptionEnabled = (option:AirtableField, wordPressFieldsSelected:string[], airtableFieldsSelected:string[]):boolean => {\n\treturn true;\n}\nexport default class MappingManagerReversed {\n\n\n\tfields:AirtableField[]\n\twordPressFields:WordPressField[]\n\tsetMapping:SetMappingSignature\n\n\tmapping: Mapping[]\n\tallSupportedAirtableTypes: SupportedSource[]\n\tprivate _airtableSelectFieldGroupsOptions:AirtableSelectFieldGroupOptions[]\n\tprivate _wordPressSelectFieldsOptions:WordPressSelectFieldGroupOptions\n\tindexedWordPressFields: Record<string, MappingOption>\n\tindexedAirtablesFields: Record<string, AirtableField>\n\n\ttemplate:Record<string, Mapping>|null\n\n\tconstructor(mappingInit:Mapping[], setMapping:SetMappingSignature, fields:AirtableField[], wordPressFields:WordPressField[], defaultMappingOptions:MappingGroupOptions, isOptionAvailable:(featurePath:string) => boolean, template:Record<string, Mapping>|null = null, wordPressOptionEnablingStrategy:WordPressOptionEnablingStrategy = isWordPressOptionEnabled, airtableOptionEnablingStrategy:AirtableOptionEnablingStrategy = isAirtableOptionEnabled ) {\n\t\tconst self = this;\n\t\tthis.fields = fields;\n\t\tthis.wordPressFields = wordPressFields;\n\t\tthis.setMapping = setMapping;\n\n\t\tthis.mapping = mappingInit.map((m) => {\n\t\t\tif (m.key) {\n\t\t\t\treturn m;\n\t\t\t}\n\t\t\treturn { ...m, key: uuidv4() } as Mapping;\n\t\t});\n\t\tthis.template = template;\n\n\t\tthis.allSupportedAirtableTypes = Object.keys(defaultMappingOptions).reduce((result, groupName) => {\n\t\t\tresult = result.concat(defaultMappingOptions[groupName].options.reduce<string[]>((supported_sources, option) => {\n\t\t\t\tsupported_sources = supported_sources.concat(option.supported_sources);\n\t\t\t\treturn supported_sources;\n\t\t\t}, []));\n\t\t\treturn result;\n\t\t}, [] as string[]);\n\n\t\tthis.indexedWordPressFields = Object.keys(defaultMappingOptions).reduce(function (result, groupName) {\n\t\t\tdefaultMappingOptions[groupName].options.forEach((field) => {\n\t\t\t\tresult[field.value] = field;\n\t\t\t}, []);\n\t\t\treturn result\n\t\t}, {} as Record<string, MappingOption>);\n\n\t\tthis.indexedAirtablesFields = fields.reduce(function (result, airtableField) {\n\t\t\tresult[airtableField.id] = airtableField;\n\t\t\treturn result\n\t\t}, {} as Record<string, AirtableField>);\n\n\t\tconst wordPressFieldsSelected = this.mapping.map(( fieldMapping) => {\n\t\t\treturn fieldMapping.wordpress;\n\t\t}, []);\n\n\t\tconst airtableFieldsSelected = this.mapping.map(( fieldMapping) => {\n\t\t\treturn fieldMapping.airtable;\n\t\t}, []);\n\n\t\tthis._airtableSelectFieldGroupsOptions = this.mapping.map((fieldMapping) => {\n\t\t\treturn fields.reduce(function (result, field) {\n\t\t\t\tconst wordPressField = self.getWordPressFieldById(fieldMapping.wordpress);\n\t\t\t\tif (wordPressField && wordPressField.supported_sources.indexOf(field.type) === -1) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\tconst group = field.group;\n\t\t\t\tif (!( group in result )) {\n\t\t\t\t\tresult[group] = {\n\t\t\t\t\t\tlabel: group,\n\t\t\t\t\t\toptions: []\n\t\t\t\t\t} as AirtableSelectFieldGroupOption;\n\t\t\t\t}\n\n\t\t\t\tresult[group].options.push({\n\t\t\t\t\t...field,\n\t\t\t\t\tenabled: airtableOptionEnablingStrategy(field, wordPressFieldsSelected, airtableFieldsSelected)\n\t\t\t\t});\n\t\t\t\treturn result;\n\t\t\t}, {} as AirtableSelectFieldGroupOptions);\n\t\t}, []);\n\n\t\tthis._wordPressSelectFieldsOptions = Object.keys(defaultMappingOptions).reduce((mappingOptions, groupName) => {\n\t\t\tconst group = { ...defaultMappingOptions[groupName] };\n\t\t\tconst groupOptions = group.options.filter(function(option) {\n\t\t\t\treturn isOptionAvailable(option.value);\n\t\t\t});\n\t\t\tif (groupOptions.length === 0) {\n\t\t\t\treturn mappingOptions;\n\t\t\t}\n\n\t\t\tmappingOptions[groupName] = group;\n\n\t\t\tgroup.options = group.options.map(function(option) {\n\t\t\t\treturn {\n\t\t\t\t\t...option,\n\t\t\t\t\tenabled: wordPressOptionEnablingStrategy(option, wordPressFieldsSelected, airtableFieldsSelected)\n\t\t\t\t};\n\t\t\t});\n\n\t\t\treturn mappingOptions;\n\t\t}, {} as WordPressSelectFieldGroupOptions);\n\n\n\t}\n\n\tgetAirtableFirstOption() {\n\t\treturn this.fields.length > 0 ? this.fields[0].id : '';\n\t}\n\n\tgetWordPressFirstOption() {\n\t\treturn this.wordPressFields.length > 0 ? this.wordPressFields[0].value : '';\n\t}\n\n\taddMappingRow() {\n\t\tconst wordPressFirstOption = this.getWordPressFirstOption();\n\n\t\tthis.setMapping([\n\t\t\t...this.mapping,\n\t\t\t{\n\t\t\t\tairtable: '',\n\t\t\t\twordpress: '',\n\t\t\t\toptions: {},\n\t\t\t\tkey: uuidv4()\n\t\t\t} as Mapping\n\t\t]);\n\t};\n\n\tupdateAirtableField(index:number, airtableFieldId:string) {\n\t\tthis.setMapping(this.mapping.map((el, i) => {\n\t\t\tif (i === index) {\n\t\t\t\treturn {\n\t\t\t\t\t...el,\n\t\t\t\t\tairtable: airtableFieldId\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn el;\n\t\t}));\n\t};\n\tupdateWordPressField(index:number, wordPressFieldId:string) {\n\t\tthis.setMapping(this.mapping.map((el, i) => {\n\t\t\tif (i === index) {\n\t\t\t\tlet airtable = el.airtable;\n\t\t\t\t// Check if we can automatically map to an airtable field.\n\t\t\t\tif (wordPressFieldId && airtable === '' && this.template && this.template[wordPressFieldId]) {\n\t\t\t\t\tairtable = this.template[wordPressFieldId].airtable;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\t...el,\n\t\t\t\t\twordpress: wordPressFieldId,\n\t\t\t\t\tairtable\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn el;\n\t\t}));\n\t};\n\tupdateFieldOption(index:number, optionName:string, optionValue:any) {\n\t\tthis.setMapping(this.mapping.map((el, i) => {\n\t\t\tif (i === index) {\n\t\t\t\treturn {\n\t\t\t\t\t...el,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\t...el.options,\n\t\t\t\t\t\t[optionName]: optionValue\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn el;\n\t\t}));\n\t};\n\tremoveMappingRow(index:number) {\n\t\tthis.setMapping(this.mapping.filter((el, i) => i !== index));\n\t};\n\n\tmoveMappingRow(oldIndex:number, newIndex:number) {\n\t\tthis.setMapping( arrayMoveImmutable(this.mapping, oldIndex, newIndex) );\n\t};\n\n\n\tgetWordPressFieldById(wordPressFieldId:string) {\n\t\treturn this.indexedWordPressFields[wordPressFieldId]\n\t};\n\n\tgetAirtableFieldById(airtableFieldId:string) {\n\t\treturn this.indexedAirtablesFields[airtableFieldId]\n\t};\n\n\n\tget airtableSelectFieldGroupsOptions(): AirtableSelectFieldGroupOptions[] {\n\t\treturn this._airtableSelectFieldGroupsOptions;\n\t}\n\n\tget wordPressSelectFieldsOptions(): WordPressSelectFieldGroupOptions {\n\t\treturn this._wordPressSelectFieldsOptions;\n\t}\n\n}\n"],"names":["uuidv4"],"mappings":";;;AAiBA,MAAM,wBAAwB,GAAG,CAAC,MAAoB,EAAE,uBAAgC,EAAE,sBAA+B,KAAY;IACpI,OAAO,MAAM,CAAC,OAAO,KAAK,uBAAuB,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,MAAM,CAAC,cAAc,CAAC;AACzG,CAAC;AACD,MAAM,uBAAuB,GAAG,CAAC,MAAoB,EAAE,uBAAgC,EAAE,sBAA+B,KAAY;AACnI,IAAA,OAAO,IAAI;AACZ,CAAC;AACa,MAAO,sBAAsB,CAAA;AAG1C,IAAA,MAAM;AACN,IAAA,eAAe;AACf,IAAA,UAAU;AAEV,IAAA,OAAO;AACP,IAAA,yBAAyB;AACjB,IAAA,iCAAiC;AACjC,IAAA,6BAA6B;AACrC,IAAA,sBAAsB;AACtB,IAAA,sBAAsB;AAEtB,IAAA,QAAQ;AAER,IAAA,WAAA,CAAY,WAAqB,EAAE,UAA8B,EAAE,MAAsB,EAAE,eAAgC,EAAE,qBAAyC,EAAE,iBAAiD,EAAE,WAAwC,IAAI,EAAE,kCAAkE,wBAAwB,EAAE,iCAAgE,uBAAuB,EAAA;QAC3b,MAAM,IAAI,GAAG,IAAI;AACjB,QAAA,IAAI,CAAC,MAAM,GAAG,MAAM;AACpB,QAAA,IAAI,CAAC,eAAe,GAAG,eAAe;AACtC,QAAA,IAAI,CAAC,UAAU,GAAG,UAAU;QAE5B,IAAI,CAAC,OAAO,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,KAAI;YACpC,IAAI,CAAC,CAAC,GAAG,EAAE;AACV,gBAAA,OAAO,CAAC;AACR,YAAA;YACD,OAAO,EAAE,GAAG,CAAC,EAAE,GAAG,EAAEA,EAAM,EAAE,EAAa;AAC1C,QAAA,CAAC,CAAC;AACF,QAAA,IAAI,CAAC,QAAQ,GAAG,QAAQ;AAExB,QAAA,IAAI,CAAC,yBAAyB,GAAG,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,SAAS,KAAI;AAChG,YAAA,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,MAAM,CAAW,CAAC,iBAAiB,EAAE,MAAM,KAAI;gBAC9G,iBAAiB,GAAG,iBAAiB,CAAC,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC;AACtE,gBAAA,OAAO,iBAAiB;AACzB,YAAA,CAAC,EAAE,EAAE,CAAC,CAAC;AACP,YAAA,OAAO,MAAM;QACd,CAAC,EAAE,EAAc,CAAC;AAElB,QAAA,IAAI,CAAC,sBAAsB,GAAG,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,MAAM,CAAC,UAAU,MAAM,EAAE,SAAS,EAAA;YAClG,qBAAqB,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,KAAK,KAAI;AAC1D,gBAAA,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,KAAK;YAC5B,CAAC,EAAE,EAAE,CAAC;AACN,YAAA,OAAO,MAAM;QACd,CAAC,EAAE,EAAmC,CAAC;QAEvC,IAAI,CAAC,sBAAsB,GAAG,MAAM,CAAC,MAAM,CAAC,UAAU,MAAM,EAAE,aAAa,EAAA;AAC1E,YAAA,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,aAAa;AACxC,YAAA,OAAO,MAAM;QACd,CAAC,EAAE,EAAmC,CAAC;QAEvC,MAAM,uBAAuB,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAE,YAAY,KAAI;YAClE,OAAO,YAAY,CAAC,SAAS;QAC9B,CAAC,EAAE,EAAE,CAAC;QAEN,MAAM,sBAAsB,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAE,YAAY,KAAI;YACjE,OAAO,YAAY,CAAC,QAAQ;QAC7B,CAAC,EAAE,EAAE,CAAC;AAEN,QAAA,IAAI,CAAC,iCAAiC,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,YAAY,KAAI;AAC1E,YAAA,OAAO,MAAM,CAAC,MAAM,CAAC,UAAU,MAAM,EAAE,KAAK,EAAA;gBAC3C,MAAM,cAAc,GAAG,IAAI,CAAC,qBAAqB,CAAC,YAAY,CAAC,SAAS,CAAC;AACzE,gBAAA,IAAI,cAAc,IAAI,cAAc,CAAC,iBAAiB,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE;AAClF,oBAAA,OAAO,MAAM;AACb,gBAAA;AACD,gBAAA,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK;AACzB,gBAAA,IAAI,EAAG,KAAK,IAAI,MAAM,CAAE,EAAE;oBACzB,MAAM,CAAC,KAAK,CAAC,GAAG;AACf,wBAAA,KAAK,EAAE,KAAK;AACZ,wBAAA,OAAO,EAAE;qBACyB;AACnC,gBAAA;AAED,gBAAA,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;AAC1B,oBAAA,GAAG,KAAK;oBACR,OAAO,EAAE,8BAA8B,CAAC,KAAK,EAAE,uBAAuB,EAAE,sBAAsB;AAC9F,iBAAA,CAAC;AACF,gBAAA,OAAO,MAAM;YACd,CAAC,EAAE,EAAqC,CAAC;QAC1C,CAAC,EAAE,EAAE,CAAC;AAEN,QAAA,IAAI,CAAC,6BAA6B,GAAG,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,MAAM,CAAC,CAAC,cAAc,EAAE,SAAS,KAAI;YAC5G,MAAM,KAAK,GAAG,EAAE,GAAG,qBAAqB,CAAC,SAAS,CAAC,EAAE;YACrD,MAAM,YAAY,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,UAAS,MAAM,EAAA;AACxD,gBAAA,OAAO,iBAAiB,CAAC,MAAM,CAAC,KAAK,CAAC;AACvC,YAAA,CAAC,CAAC;AACF,YAAA,IAAI,YAAY,CAAC,MAAM,KAAK,CAAC,EAAE;AAC9B,gBAAA,OAAO,cAAc;AACrB,YAAA;AAED,YAAA,cAAc,CAAC,SAAS,CAAC,GAAG,KAAK;YAEjC,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,UAAS,MAAM,EAAA;gBAChD,OAAO;AACN,oBAAA,GAAG,MAAM;oBACT,OAAO,EAAE,+BAA+B,CAAC,MAAM,EAAE,uBAAuB,EAAE,sBAAsB;iBAChG;AACF,YAAA,CAAC,CAAC;AAEF,YAAA,OAAO,cAAc;QACtB,CAAC,EAAE,EAAsC,CAAC;IAG3C;IAEA,sBAAsB,GAAA;QACrB,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,EAAE;IACvD;IAEA,uBAAuB,GAAA;QACtB,OAAO,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;IAC5E;IAEA,aAAa,GAAA;AACZ,QAA6B,IAAI,CAAC,uBAAuB;QAEzD,IAAI,CAAC,UAAU,CAAC;YACf,GAAG,IAAI,CAAC,OAAO;AACf,YAAA;AACC,gBAAA,QAAQ,EAAE,EAAE;AACZ,gBAAA,SAAS,EAAE,EAAE;AACb,gBAAA,OAAO,EAAE,EAAE;gBACX,GAAG,EAAEA,EAAM;AACA;AACZ,SAAA,CAAC;IACH;;IAEA,mBAAmB,CAAC,KAAY,EAAE,eAAsB,EAAA;AACvD,QAAA,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,KAAI;YAC1C,IAAI,CAAC,KAAK,KAAK,EAAE;gBAChB,OAAO;AACN,oBAAA,GAAG,EAAE;AACL,oBAAA,QAAQ,EAAE;iBACV;AACD,YAAA;AACD,YAAA,OAAO,EAAE;QACV,CAAC,CAAC,CAAC;IACJ;;IACA,oBAAoB,CAAC,KAAY,EAAE,gBAAuB,EAAA;AACzD,QAAA,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,KAAI;YAC1C,IAAI,CAAC,KAAK,KAAK,EAAE;AAChB,gBAAA,IAAI,QAAQ,GAAG,EAAE,CAAC,QAAQ;;AAE1B,gBAAA,IAAI,gBAAgB,IAAI,QAAQ,KAAK,EAAE,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,EAAE;oBAC5F,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC,QAAQ;AACnD,gBAAA;gBACD,OAAO;AACN,oBAAA,GAAG,EAAE;AACL,oBAAA,SAAS,EAAE,gBAAgB;oBAC3B;iBACA;AACD,YAAA;AACD,YAAA,OAAO,EAAE;QACV,CAAC,CAAC,CAAC;IACJ;;AACA,IAAA,iBAAiB,CAAC,KAAY,EAAE,UAAiB,EAAE,WAAe,EAAA;AACjE,QAAA,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,KAAI;YAC1C,IAAI,CAAC,KAAK,KAAK,EAAE;gBAChB,OAAO;AACN,oBAAA,GAAG,EAAE;AACL,oBAAA,OAAO,EAAE;wBACR,GAAG,EAAE,CAAC,OAAO;wBACb,CAAC,UAAU,GAAG;AACd;iBACD;AACD,YAAA;AACD,YAAA,OAAO,EAAE;QACV,CAAC,CAAC,CAAC;IACJ;;AACA,IAAA,gBAAgB,CAAC,KAAY,EAAA;QAC5B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,KAAK,KAAK,CAAC,CAAC;IAC7D;;IAEA,cAAc,CAAC,QAAe,EAAE,QAAe,EAAA;AAC9C,QAAA,IAAI,CAAC,UAAU,CAAE,kBAAkB,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAE;IACxE;;AAGA,IAAA,qBAAqB,CAAC,gBAAuB,EAAA;AAC5C,QAAA,OAAO,IAAI,CAAC,sBAAsB,CAAC,gBAAgB,CAAC;IACrD;;AAEA,IAAA,oBAAoB,CAAC,eAAsB,EAAA;AAC1C,QAAA,OAAO,IAAI,CAAC,sBAAsB,CAAC,eAAe,CAAC;IACpD;;AAGA,IAAA,IAAI,gCAAgC,GAAA;QACnC,OAAO,IAAI,CAAC,iCAAiC;IAC9C;AAEA,IAAA,IAAI,4BAA4B,GAAA;QAC/B,OAAO,IAAI,CAAC,6BAA6B;IAC1C;AAEA;;;;"}